"use strict";var pdf2htmlEX=window.pdf2htmlEX=window.pdf2htmlEX||{},CSS_CLASS_NAMES={page_frame:"pf",page_content_box:"pc",page_data:"pi",background_image:"bi",link:"l",input_radio:"ir",__dummy__:"no comma"},DEFAULT_CONFIG={container_id:"page-container",sidebar_id:"sidebar",outline_id:"outline",loading_indicator_cls:"loading-indicator",preload_pages:3,render_timeout:100,scale_step:.9,key_handler:!0,hashchange_handler:!0,view_history_handler:!0,__dummy__:"no comma"},EPS=1e-6;function invert(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[3]*e[4])/t,(e[1]*e[4]-e[0]*e[5])/t]}function transform(e,t){return[e[0]*t[0]+e[2]*t[1]+e[4],e[1]*t[0]+e[3]*t[1]+e[5]]}function get_page_number(e){return parseInt(e.getAttribute("data-page-no"),16)}function disable_dragstart(e){for(var t=0,i=e.length;t<i;++t)e[t].addEventListener("dragstart",function(){return!1},!1)}function clone_and_extend_objs(e){for(var t={},i=0,n=arguments.length;i<n;++i){var a=arguments[i];for(var s in a)a.hasOwnProperty(s)&&(t[s]=a[s])}return t}function Page(e){if(e){this.loaded=!1,this.shown=!1,this.page=e,this.num=get_page_number(e),this.original_height=e.clientHeight,this.original_width=e.clientWidth;var t=e.getElementsByClassName(CSS_CLASS_NAMES.page_content_box)[0];t&&(this.content_box=t,this.original_scale=this.cur_scale=this.original_height/t.clientHeight,this.page_data=JSON.parse(e.getElementsByClassName(CSS_CLASS_NAMES.page_data)[0].getAttribute("data-data")),this.ctm=this.page_data.ctm,this.ictm=invert(this.ctm),this.loaded=!0)}}function Viewer(e){this.config=clone_and_extend_objs(DEFAULT_CONFIG,arguments.length>0?e:{}),this.pages_loading=[],this.init_before_loading_content();var t=this;document.addEventListener("DOMContentLoaded",function(){t.init_after_loading_content()},!1)}Page.prototype={hide:function(){this.loaded&&this.shown&&(this.content_box.classList.remove("opened"),this.shown=!1)},show:function(){this.loaded&&!this.shown&&(this.content_box.classList.add("opened"),this.shown=!0)},rescale:function(e){if(this.cur_scale=0===e?this.original_scale:e,this.loaded){var t=this.content_box.style;t.msTransform=t.webkitTransform=t.transform="scale("+this.cur_scale.toFixed(3)+")"}var i=this.page.style;i.height=this.original_height*this.cur_scale+"px",i.width=this.original_width*this.cur_scale+"px"},view_position:function(){var e=this.page,t=e.parentNode;return[t.scrollLeft-e.offsetLeft-e.clientLeft,t.scrollTop-e.offsetTop-e.clientTop]},height:function(){return this.page.clientHeight},width:function(){return this.page.clientWidth}},Viewer.prototype={scale:1,cur_page_idx:0,first_page_idx:0,init_before_loading_content:function(){this.pre_hide_pages()},initialize_radio_button:function(){for(var e=document.getElementsByClassName(CSS_CLASS_NAMES.input_radio),t=0;t<e.length;t++){e[t].addEventListener("click",function(){this.classList.toggle("checked")})}},init_after_loading_content:function(){this.sidebar=document.getElementById(this.config.sidebar_id),this.outline=document.getElementById(this.config.outline_id),this.container=document.getElementById(this.config.container_id),this.loading_indicator=document.getElementsByClassName(this.config.loading_indicator_cls)[0];for(var e=!0,t=this.outline.childNodes,i=0,n=t.length;i<n;++i){if("ul"===t[i].nodeName.toLowerCase()){e=!1;break}}if(e||this.sidebar.classList.add("opened"),this.find_pages(),0!=this.pages.length){disable_dragstart(document.getElementsByClassName(CSS_CLASS_NAMES.background_image)),this.config.key_handler&&this.register_key_handler();var a=this;this.config.hashchange_handler&&window.addEventListener("hashchange",function(e){a.navigate_to_dest(document.location.hash.substring(1))},!1),this.config.view_history_handler&&window.addEventListener("popstate",function(e){e.state&&a.navigate_to_dest(e.state)},!1),document.addEventListener("scroll",function(){a.update_page_idx(),a.schedule_render(!0)},!1),[this.container,this.outline].forEach(function(e){e.addEventListener("click",a.link_handler.bind(a),!1)}),this.initialize_radio_button(),this.render()}},find_pages:function(){for(var e=[],t={},i=this.container.childNodes,n=0,a=i.length;n<a;++n){var s=i[n];if(s.nodeType===Node.ELEMENT_NODE&&s.classList.contains(CSS_CLASS_NAMES.page_frame)){var o=new Page(s);e.push(o),t[o.num]=e.length-1}}this.pages=e,this.page_map=t},load_page:function(e,t,i){var n=this.pages;if(!(e>=n.length)){var a=n[e];if(!a.loaded&&!this.pages_loading[e]){var s=a.page,o=s.getAttribute("data-page-url");if(o){this.pages_loading[e]=!0;var r=s.getElementsByClassName(this.config.loading_indicator_cls)[0];void 0===r&&((r=this.loading_indicator.cloneNode(!0)).classList.add("active"),s.appendChild(r));var c=this,l=e,h=new XMLHttpRequest;h.open("GET",o,!0),h.onload=function(){if(200===h.status||0===h.status){var e=document.createElement("div");e.innerHTML=h.responseText;for(var t=null,n=e.childNodes,a=0,s=n.length;a<s;++a){var o=n[a];if(o.nodeType===Node.ELEMENT_NODE&&o.classList.contains(CSS_CLASS_NAMES.page_frame)){t=o;break}}var r=c.pages[l];c.container.replaceChild(t,r.page),r=new Page(t),c.pages[l]=r,r.hide(),r.rescale(c.scale),disable_dragstart(t.getElementsByClassName(CSS_CLASS_NAMES.background_image)),c.schedule_render(!1),i&&i(r)}delete c.pages_loading[l]},h.send(null)}if(void 0===t&&(t=this.config.preload_pages),--t>0){c=this;setTimeout(function(){c.load_page(e+1,t)},0)}}}},pre_hide_pages:function(){var e="@media screen{."+CSS_CLASS_NAMES.page_content_box+"{display:none;}}",t=document.createElement("style");t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.head.appendChild(t)},render:function(){for(var e=this.container,t=e.scrollTop,i=e.clientHeight,n=t-i,a=t+i+i,s=(this.cur_page_idx,this.pages),o=0,r=s.length;o<r;++o){var c=s[o],l=c.page,h=l.offsetTop+l.clientTop,d=l.clientHeight;h<=a&&h+d>=n?c.loaded?c.show():this.load_page(o):c.hide()}},update_page_idx:function(){var e=this.pages,t=e.length;if(!(t<2)){for(var i=this.container,n=i.scrollTop,a=n+i.clientHeight,s=-1,o=t,r=o-s;r>1;){var c=s+Math.floor(r/2);(g=e[c].page).offsetTop+g.clientTop+g.clientHeight>=n?o=c:s=c,r=o-s}this.first_page_idx=o;for(var l=this.cur_page_idx,h=l,d=0,_=o;_<t;++_){var g,p=(g=e[_].page).offsetTop+g.clientTop,f=g.clientHeight,u=p+f;if(p>a)break;var v=(Math.min(a,u)-Math.max(n,p))/f;if(_===l&&Math.abs(v-1)<=EPS){h=l;break}v>d&&(d=v,h=_)}this.cur_page_idx=h}},schedule_render:function(e){if(void 0!==this.render_timer){if(!e)return;clearTimeout(this.render_timer)}var t=this;this.render_timer=setTimeout(function(){delete t.render_timer,t.render()},this.config.render_timeout)},register_key_handler:function(){var e=this;window.addEventListener("DOMMouseScroll",function(t){if(t.ctrlKey){t.preventDefault();var i=e.container,n=i.getBoundingClientRect(),a=[t.clientX-n.left-i.clientLeft,t.clientY-n.top-i.clientTop];e.rescale(Math.pow(e.config.scale_step,t.detail),!0,a)}},!1),window.addEventListener("keydown",function(t){var i=!1,n=t.ctrlKey||t.metaKey,a=t.altKey;switch(t.keyCode){case 61:case 107:case 187:n&&(e.rescale(1/e.config.scale_step,!0),i=!0);break;case 173:case 109:case 189:n&&(e.rescale(e.config.scale_step,!0),i=!0);break;case 48:n&&(e.rescale(0,!1),i=!0);break;case 33:a?e.scroll_to(e.cur_page_idx-1):e.container.scrollTop-=e.container.clientHeight,i=!0;break;case 34:a?e.scroll_to(e.cur_page_idx+1):e.container.scrollTop+=e.container.clientHeight,i=!0;break;case 35:e.container.scrollTop=e.container.scrollHeight,i=!0;break;case 36:e.container.scrollTop=0,i=!0}i&&t.preventDefault()},!1)},rescale:function(e,t,i){var n=this.scale,a=n;0===e?(a=1,t=!1):t?a*=e:a=e,this.scale=a,i||(i=[0,0]);var s=this.container;i[0]+=s.scrollLeft,i[1]+=s.scrollTop;for(var o=this.pages,r=o.length,c=this.first_page_idx;c<r;++c){var l=o[c].page;if(l.offsetTop+l.clientTop>=i[1])break}var h=c-1;h<0&&(h=0);var d=o[h].page,_=d.clientWidth,g=d.clientHeight,p=d.offsetLeft+d.clientLeft,f=i[0]-p;f<0?f=0:f>_&&(f=_);var u=d.offsetTop+d.clientTop,v=i[1]-u;v<0?v=0:v>g&&(v=g);for(c=0;c<r;++c)o[c].rescale(a);s.scrollLeft+=f/n*a+d.offsetLeft+d.clientLeft-f-p,s.scrollTop+=v/n*a+d.offsetTop+d.clientTop-v-u,this.schedule_render(!0)},fit_width:function(){var e=this.cur_page_idx;this.rescale(this.container.clientWidth/this.pages[e].width(),!0),this.scroll_to(e)},fit_height:function(){var e=this.cur_page_idx;this.rescale(this.container.clientHeight/this.pages[e].height(),!0),this.scroll_to(e)},get_containing_page:function(e){for(;e;){if(e.nodeType===Node.ELEMENT_NODE&&e.classList.contains(CSS_CLASS_NAMES.page_frame)){var t=get_page_number(e),i=this.page_map;return t in i?this.pages[i[t]]:null}e=e.parentNode}return null},link_handler:function(e){var t=e.target,i=t.getAttribute("data-dest-detail");if(i){if(this.config.view_history_handler)try{var n=this.get_current_view_hash();window.history.replaceState(n,"","#"+n),window.history.pushState(i,"","#"+i)}catch(e){}this.navigate_to_dest(i,this.get_containing_page(t)),e.preventDefault()}},navigate_to_dest:function(e,t){try{var i=JSON.parse(e)}catch(e){return}if(i instanceof Array){var n=i[0],a=this.page_map;if(n in a){for(var s=a[n],o=this.pages[s],r=2,c=i.length;r<c;++r){var l=i[r];if(null!==l&&"number"!=typeof l)return}for(;i.length<6;)i.push(null);var h=t||this.pages[this.cur_page_idx],d=h.view_position();d=transform(h.ictm,[d[0],h.height()-d[1]]);var _=this.scale,g=[0,0],p=!0,f=!1,u=this.scale;switch(i[1]){case"XYZ":g=[null===i[2]?d[0]:i[2]*u,null===i[3]?d[1]:i[3]*u],null!==(_=i[4])&&0!==_||(_=this.scale),f=!0;break;case"Fit":case"FitB":g=[0,0],f=!0;break;case"FitH":case"FitBH":g=[0,null===i[2]?d[1]:i[2]*u],f=!0;break;case"FitV":case"FitBV":g=[null===i[2]?d[0]:i[2]*u,0],f=!0;break;case"FitR":g=[i[2]*u,i[5]*u],p=!1,f=!0}if(f){this.rescale(_,!1);var v=this,m=function(e){g=transform(e.ctm,g),p&&(g[1]=e.height()-g[1]),v.scroll_to(s,g)};o.loaded?m(o):(this.load_page(s,void 0,m),this.scroll_to(s))}}}},scroll_to:function(e,t){var i=this.pages;if(!(e<0||e>=i.length)){var n=i[e].view_position();void 0===t&&(t=[0,0]);var a=this.container;a.scrollLeft+=t[0]-n[0],a.scrollTop+=t[1]-n[1]}},get_current_view_hash:function(){var e=[],t=this.pages[this.cur_page_idx];e.push(t.num),e.push("XYZ");var i=t.view_position();return i=transform(t.ictm,[i[0],t.height()-i[1]]),e.push(i[0]/this.scale),e.push(i[1]/this.scale),e.push(this.scale),JSON.stringify(e)}},pdf2htmlEX.Viewer=Viewer,window.onload=function(){for(var e=document.getElementsByClassName("pf w0 h0"),t=0,i=0,n=e.length;i<n;i++)t+=e[i].scrollHeight+20;t>0&&(document.getElementById("page-container").style.height=t+"px",document.getElementById("page-container").style.overflow="hidden")};
